<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- ๐งพ Tree View -->
    <record id="view_school_trip_request_tree" model="ir.ui.view">
        <field name="name">school.trip.request.tree</field>
        <field name="model">school.trip.request</field>
        <field name="arch" type="xml">
            <tree string="ุทูุจุงุช ุงูุฑุญูุงุช ุงููุฏุฑุณูุฉ" 
                  decoration-success="state == 'approved'" 
                  decoration-info="state == 'transport'" 
                  decoration-warning="state == 'leader'"
                  decoration-muted="state == 'cancelled'">
                <field name="name"/>
                <field name="trip_type"/>
                <field name="date_from"/>
                <field name="day_name"/>
                <field name="students_count"/>
                <field name="buses_count"/>
                <field name="trip_purpose"/>
                <field name="event_id" optional="show"/>
                <field name="state" widget="badge" 
                       decoration-success="state == 'approved'"
                       decoration-info="state == 'transport'"
                       decoration-warning="state == 'leader'"
                       decoration-muted="state == 'cancelled'"/>
            </tree>
        </field>
    </record>

    <!-- ๐ Form View -->
    <record id="view_school_trip_request_form" model="ir.ui.view">
        <field name="name">school.trip.request.form</field>
        <field name="model">school.trip.request</field>
        <field name="arch" type="xml">
            <form string="ุทูุจ ุฑุญูุฉ ูุฏุฑุณูุฉ">

                <header>
                    <!-- ุฃุฒุฑุงุฑ ุณูุฑ ุงูุนูู -->
                    <button name="action_submit"
                            string="ุฅุฑุณุงู ุฅูู ูุงุฆุฏ ุงููุฏุฑุณุฉ"
                            type="object"
                            states="draft"
                            class="btn-primary"/>

                    <button name="action_leader_approve"
                            string="ุชุญููู ููุณุคูู ุงูููู"
                            type="object"
                            states="leader"
                            class="btn-info"/>

                    <button name="action_approve"
                            string="ุงุนุชูุงุฏ ููุงุฆู"
                            type="object"
                            states="transport"
                            class="btn-success"/>

                    <!-- ุฃุฒุฑุงุฑ ุฅุถุงููุฉ -->
                    <button name="action_cancel"
                            string="ุฅูุบุงุก"
                            type="object"
                            states="draft,leader,transport"
                            class="btn-danger"
                            confirm="ูู ุฃูุช ูุชุฃูุฏ ูู ุฅูุบุงุก ูุฐุง ุงูุทูุจุ"/>
                    
                    <button name="action_reset_to_draft"
                            string="ุฅุนุงุฏุฉ ูููุณูุฏุฉ"
                            type="object"
                            states="cancelled"
                            class="btn-secondary"/>

                    <!-- ุฒุฑ ุงูุทุจุงุนุฉ -->
                    <button name="%(action_school_trip_report_pdf)d"
                            string="๐จ๏ธ ุทุจุงุนุฉ ุงููููุฐุฌ"
                            type="action"
                            class="btn-secondary"
                            states="approved"/>

                    <!-- ุดุฑูุท ุงูุญุงูุฉ -->
                    <field name="state"
                           widget="statusbar"
                           statusbar_visible="draft,leader,transport,approved"/>
                </header>

                <sheet>
                    <!-- โ Smart Buttons -->
                    <div class="oe_button_box" name="button_box">
                        <!-- ุฒุฑ ุงููุนุงููุฉ ุงููุฑุชุจุทุฉ -->
                        <button name="action_view_event"
                                type="object"
                                class="oe_stat_button"
                                icon="fa-calendar"
                                attrs="{'invisible': [('event_id', '=', False)]}">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_text">ุงููุนุงููุฉ</span>
                                <span class="o_stat_text">ุงููุฑุชุจุทุฉ</span>
                            </div>
                        </button>
                    </div>

                    <!-- โ ุชูุจูู: ุชู ุฅูุดุงุก ุงูุทูุจ ูู ูุนุงููุฉ -->
                    <div class="alert alert-success" role="alert" 
                         attrs="{'invisible': [('event_id', '=', False)]}">
                        <strong>โน๏ธ ููุงุญุธุฉ:</strong> 
                        ุชู ุฅูุดุงุก ูุฐุง ุงูุทูุจ ุชููุงุฆูุงู ูู ุงููุนุงููุฉ ุงููุฑุชุจุทุฉ. 
                        ููููู ุชุนุฏูู ุงูุชูุงุตูู ูุฅููุงู ุนูููุฉ ุงูุงุนุชูุงุฏ.
                    </div>

                    <!-- ุจูุงูุงุช ุงูุฑุญูุฉ ุงูุฃุณุงุณูุฉ -->
                    <group>
                        <group string="ูุนูููุงุช ุงูุฑุญูุฉ">
                            <field name="name" readonly="1"/>
                            <field name="event_id" readonly="1" attrs="{'invisible': [('event_id', '=', False)]}"/>
                            <field name="trip_type" attrs="{'readonly': [('state', 'in', ['approved', 'cancelled'])]}"/>
                            <field name="date_from" attrs="{'readonly': [('state', 'in', ['approved', 'cancelled'])]}"/>
                            <field name="day_name" readonly="1"/>
                            <field name="trip_purpose" attrs="{'readonly': [('state', 'in', ['approved', 'cancelled'])]}"/>
                            <field name="stage" attrs="{'readonly': [('state', 'in', ['approved', 'cancelled'])]}"/>
                        </group>
                        <group string="ุชูุงุตูู ุงูููู">
                            <field name="students_count" attrs="{'readonly': [('state', 'in', ['approved', 'cancelled'])]}"/>
                            <field name="buses_count" attrs="{'readonly': [('state', 'in', ['approved', 'cancelled'])]}"/>
                            <field name="school_ids" 
                                   widget="many2many_tags" 
                                   attrs="{'readonly': [('state', 'in', ['approved', 'cancelled'])]}" 
                                   options="{'no_create': True, 'color_field': 'color'}"/>
                            <field name="direction_to" attrs="{'readonly': [('state', 'in', ['approved', 'cancelled'])]}"/>
                        </group>
                    </group>

                    <!-- ุจูุงูุงุช ุงูููุงููุงุช -->
                    <group>
                        <group string="ุจูุงูุงุช ููุฏู ุงูุทูุจ">
                            <field name="applicant_name" attrs="{'readonly': [('state', 'in', ['approved', 'cancelled'])]}"/>
                            <field name="applicant_mobile" 
                                   attrs="{'readonly': [('state', 'in', ['approved', 'cancelled'])]}"
                                   placeholder="05xxxxxxxx"/>
                        </group>
                        <group string="ุงูููุงููุงุช">
                            <field name="school_leader_name" attrs="{'readonly': [('state', 'in', ['approved', 'cancelled'])]}"/>
                            <field name="transport_approval" readonly="1"/>
                        </group>
                    </group>

                    <!-- โ ุชุจููุจ ุชูุงุตูู ุงูุญุงููุงุช -->
                    <notebook>
                        <page string="ุชูุงุตูู ุงูุญุงููุงุช"
                              attrs="{'invisible': [('state', 'not in', ['transport', 'approved'])]}">
                            <field name="bus_line_ids"
                                   attrs="{'readonly': [('state', '=', 'approved')]}">
                                <tree editable="bottom">
                                    <field name="vehicle_id" 
                                           options="{'no_create': True}"
                                           domain="[('vehicle_type', '=', 'bus')]"/>
                                    <field name="license_plate" readonly="1"/>
                                    <field name="driver_id" options="{'no_create': True}"/>
                                    <field name="driver_mobile" readonly="1"/>
                                    <field name="seats" readonly="1"/>
                                    <field name="notes"/>
                                </tree>
                            </field>
                        </page>
                        
                        <!-- ุชุจููุจ ุฅุถุงูู ูููุนูููุงุช -->
                        <page string="ูุนูููุงุช ุฅุถุงููุฉ">
                            <group>
                                <group>
                                    <field name="create_date" readonly="1"/>
                                    <field name="create_uid" readonly="1"/>
                                </group>
                                <group>
                                    <field name="write_date" readonly="1"/>
                                    <field name="write_uid" readonly="1"/>
                                </group>
                            </group>
                        </page>
                    </notebook>
                </sheet>

                <!-- โ ุดุงุช ุงูููุงุญุธุงุช ูุงูุชุชุจุน -->
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="activity_ids" widget="mail_activity"/>
                    <field name="message_ids" widget="mail_thread" options="{'post_refresh': 'recipients'}"/>
                </div>
            </form>
        </field>
    </record>

    <!-- ๐ Search View -->
    <record id="view_school_trip_request_search" model="ir.ui.view">
        <field name="name">school.trip.request.search</field>
        <field name="model">school.trip.request</field>
        <field name="arch" type="xml">
            <search string="ุจุญุซ ูู ุทูุจุงุช ุงูุฑุญูุงุช">
                <field name="name" string="ุฑูู ุงูุทูุจ"/>
                <field name="trip_purpose" string="ุงูุบุฑุถ"/>
                <field name="applicant_name" string="ููุฏู ุงูุทูุจ"/>
                <field name="school_ids" string="ุงููุฏุฑุณุฉ"/>
                
                <filter name="draft" string="ูุณูุฏุฉ" domain="[('state', '=', 'draft')]"/>
                <filter name="leader" string="ูุงุฆุฏ ุงููุฏุฑุณุฉ" domain="[('state', '=', 'leader')]"/>
                <filter name="transport" string="ูุณุคูู ุงูููู" domain="[('state', '=', 'transport')]"/>
                <filter name="approved" string="ูุนุชูุฏ" domain="[('state', '=', 'approved')]"/>
                <filter name="cancelled" string="ููุบู" domain="[('state', '=', 'cancelled')]"/>
                
                <separator/>
                <filter name="with_event" string="ูุฑุชุจุท ุจูุนุงููุฉ" domain="[('event_id', '!=', False)]"/>
                <filter name="without_event" string="ุจุฏูู ูุนุงููุฉ" domain="[('event_id', '=', False)]"/>
                
                <separator/>
                <filter name="this_month" string="ูุฐุง ุงูุดูุฑ" 
                        domain="[('date_from', '&gt;=', (context_today() - relativedelta(day=1)).strftime('%Y-%m-%d')),
                                 ('date_from', '&lt;=', (context_today() + relativedelta(day=31)).strftime('%Y-%m-%d'))]"/>
                
                <group expand="0" string="ุชุฌููุน ุญุณุจ">
                    <filter name="group_state" string="ุงูุญุงูุฉ" context="{'group_by': 'state'}"/>
                    <filter name="group_trip_type" string="ููุน ุงูุฑุญูุฉ" context="{'group_by': 'trip_type'}"/>
                    <filter name="group_stage" string="ุงููุฑุญูุฉ" context="{'group_by': 'stage'}"/>
                    <filter name="group_date" string="ุงูุชุงุฑูุฎ" context="{'group_by': 'date_from'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- โ๏ธ Action -->
    <record id="action_school_trip_request" model="ir.actions.act_window">
        <field name="name">ุทูุจุงุช ุงูุฑุญูุงุช ุงููุฏุฑุณูุฉ</field>
        <field name="res_model">school.trip.request</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                ูุง ุชูุฌุฏ ุทูุจุงุช ุฑุญูุงุช ุญุงููุงู
            </p>
            <p>
                ูุนุธู ุทูุจุงุช ุงูุฑุญูุงุช ูุชู ุฅูุดุงุคูุง ุชููุงุฆูุงู ูู ุงููุนุงููุงุช.
                <br/>
                ุนูุฏ ุฅูุดุงุก ูุนุงููุฉ ูู ููุน "ุฑุญูุฉ ูุฏุฑุณูุฉ"ุ ุณูุชู ุฅูุดุงุก ุทูุจ ุงูุฑุญูุฉ ุชููุงุฆูุงู.
            </p>
        </field>
    </record>

    <!-- ๐ Menus -->
    <menuitem id="menu_school_trip_root" 
              name="ุงูุฑุญูุงุช ุงููุฏุฑุณูุฉ" 
              sequence="100"
              web_icon="kb_school_trip_request,static/description/icon.png"/>
    
    <menuitem id="menu_school_trip_request"
              name="ุทูุจุงุช ุงูุฑุญูุงุช"
              parent="menu_school_trip_root"
              action="action_school_trip_request"
              sequence="10"/>

</odoo>